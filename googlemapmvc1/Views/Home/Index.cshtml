
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <script src="~/Scripts/jquery-2.2.3.min.js"></script>
    <script src="~/Scripts/moment.min.js"></script>

    <link rel="stylesheet" href="~/Content/bootstrap.css" />
    <link rel="stylesheet" href="~/Content/c3.css" />

    <script src="~/Scripts/chart.js"></script>
    <script src="~/Scripts/d3.min.js"></script>
    <script src="~/Scripts/c3.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDe1iRGmDMXSwy0py_TRHruCp49TO0eyuU"></script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width",initial-scale="1" />
    <title>Index</title>

    <style>
        
 body{background-color : #024282;margin : 5px;padding : 5px }
    
   #mynav {background-color:#012d46;
           border-color : #012d46
   }      
  
   img {margin-top : 10px}

   input {width : 150px}

   #rangeselector {
              border : 1px;border-style : solid; border-color : black;
              height : 100px;  border-radius : 10px;
              font-family: 'Open Sans', sans-serif;
              font-size : 12px;
              padding : 2px; background-color:#F2F6F7;

   }
  
    select { border-radius : 10px; font-family: 'Open Sans', sans-serif;
              font-size : 12px;
              padding : 6px 1px;background-color:#F2F6F7

    }
   
  #piechartcontrol {
              border : 1px;border-style : solid; border-color : black;
              height : 250px;  border-radius : 10px;
              font-family: 'Open Sans', sans-serif;
              font-size : 11px;
              padding : 10px;background-color:#F2F6F7

    }


  #tablecontrol,#customrange {
              border : 1px;border-style : solid; border-color : black;
              height : 200px;  border-radius : 10px;
              font-family: 'Open Sans', sans-serif;
              font-size : 11px;
              padding : 10px;background-color:#F2F6F7

    }

  #tablehits {border : 1px;border-style : solid; border-color : black;
              height : 200px;  border-radius : 10px;
              font-family: 'Open Sans', sans-serif;
              font-size : 11px;
              padding : 10px;background-color:#F2F6F7

  }

  #piecharthits {
              border : 2px;border-style : solid; border-color : black;
              height : 250px; border-radius : 10px;
              font-family: 'Open Sans', sans-serif;
              font-size : 11px;
              padding : 10px;background-color:#F2F6F7;


    }
   
     p {font-family: 'Open Sans', sans-serif;
              font-size : 11px;
              padding : 10px;background-color:#F2F6F7;}  
     
     table,th,td {  border : 1px;border-style : solid; border-color : black;
              border-radius : 2px;


     }   

    </style>
</head>
<body>
    <nav class="navbar navbar-default" id="mynav">
        <div class="container-fluid">
            
            <ul>
                <li><img src="http://www.q2c.be/Content/Images/q2c-logo-neg.png" alt="test" style="width : 62px; height: 20px;"></li>
            </ul>
        </div>

    </nav>

    <div class="container">
    <div class="row">

            <div class="col-sm-4">
                <div id="rangeselector">
                    <p>Kies periode voor data analyse </p>
                    <div id="selectdiv">
                       
                        <select name="rangeselect" id="rangeselect">
                            <option value="0">vandaag</option>

                        </select>
                       
                    </div>
                   

                </div>
               

            </div>
  
        <div class="col-sm-4">
            <div id="piechartcontrol">
                <canvas id="piechartcanvascontrol"></canvas>
            </div>
        </div>

            <div class="col-sm-4">
                <div id="piecharthits">
                    <canvas id="piechartcanvashits"></canvas>
                </div>
            </div>


        </div>

    <div class="row">
        <div class="col-sm-4">
            <div id="customrange">
  
                   <input type="submit" value="Valideer"/>
               

            </div>

        </div>
        <div class="col-sm-4">
            <div id="tablecontrol">
                <table id="controltable">
                    <tr>
                        <th>Type scan</th>
                        <th> Aantal</th>
                        <th>percentage</th>

                    </tr>

                </table>

            </div>
        </div>
        <div class="col-sm-4">
            <div id="tablehits">
                <table id="hittable">
                    <tr>
                        <th>Type hits</th>
                        <th> Aantal</th>
                        <th>percentage</th>

                    </tr>

                </table>

            </div>
        </div>
       
    </div>
    </div>
   
    <script type="text/javascript">

        var controlsvandaag = @Html.Raw(ViewBag.Controlsvandaagjson);
        var controlsgisteren=@Html.Raw(ViewBag.Controlsgisterenjson);
        var controlsdezeweek=@Html.Raw(ViewBag.Controlsdezeweekjson);
        var controlsvorigeweek=@Html.Raw(ViewBag.Controlsvorigeweekjson);
        var controlsdezemaand=@Html.Raw(ViewBag.Controlsdezemaandjson);
        var controlsvorigemaand=@Html.Raw(ViewBag.Controlsvorigemaandjson);

        var hitsvandaag = @Html.Raw(ViewBag.Hitsvandaagjson);
        var hitsgisteren=@Html.Raw(ViewBag.Hitsgisterenjson);
        var hitsdezeweek=@Html.Raw(ViewBag.Hitsdezeweekjson);
        var hitsvorigeweek=@Html.Raw(ViewBag.Hitsvorigeweekjson);
        var hitsdezemaand=@Html.Raw(ViewBag.Hitsdezemaandjson);
        var hitsvorigemaand=@Html.Raw(ViewBag.Hitsvorigemaandjson);


        var typecontrols = @Html.Raw(ViewBag.Typecontrolsjson);

        var hittypes = @Html.Raw(ViewBag.Hittypesjson);


        var dicttypecontrol = {

            0 :'Parking Monitor',"NULL" : 'Parking Monitor',1 :'Uurrooster', 2: 'SMS', 3: 'Abonnement',
            5: 'Tweede RB',7: 'Bevroren Nummerplaat', 20: 'Sensibilisering', 100: 'YellowBrick', 110: 'PayByPhone',
            120: 'Parkeon', 130: 'Mobigo', 140: 'Presto', 150: 'MobileFor', 160: 'ParkMobile', 170: 'Extenso',
            180: 'CEVI', 190: 'Hectronic', 200: 'Parkare', 999: 'TOTAAL'

        };

        $("#rangeselect").append("<option value=1>" + "gisteren"  + "</option>");
        $("#rangeselect").append("<option value=2>" + "deze week"  + "</option>");
        $("#rangeselect").append("<option value=3>" + "vorige week"  + "</option>");
        $("#rangeselect").append("<option value=4>" + "deze maand"  + "</option>");
        $("#rangeselect").append("<option value=5>" + "vorige maand"  + "</option>");
        $("#rangeselect").append("<option value=6>" + "bepaal zelf periode"  + "</option>");


        $("#customrange").hide();

        var tablescantype = document.getElementById("controltable");
        var tablehittype = document.getElementById("hittable");

        //code for piechart type control when page firstloaded
        var counttypecontrol =[];
        var labelsoftypecontrols =[];
        var a=null;
        for (i=0;i<typecontrols.length;i++) {

            var check = typecontrols[i];

            var label = dicttypecontrol[check];
            var counter=0;
            for (j=0;j<controlsvandaag.length;j++){
                if ((controlsvandaag[j].typecontrol==check) || (controlsvandaag[j].typecontrol===a)){

                    counter= counter+1}

            }

            var typeperc = ((counter/controlsvandaag.length)*100).toFixed(2);
            counttypecontrol.push(typeperc);
            labelsoftypecontrols.push(label);

            //code table type controle
            var row = tablescantype.insertRow(i+1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = label;
            cell2.innerHTML = counter;
            cell3.innerHTML = typeperc;

        };
        var rowtotal = tablescantype.insertRow(typecontrols.length+1);
        var celltotal1 = rowtotal.insertCell(0);
        var celltotal2= rowtotal.insertCell(1);
        var celltotal3=rowtotal.insertCell(2);

        celltotal1.innerHTML="Totaal";
        celltotal2.innerHTML= controlsvandaag.length;
        celltotal3.innerHTML="100%";

        var canvascontrol = document.getElementById("piechartcanvascontrol")
        var ctxcontrol = canvascontrol.getContext("2d");

        var controlpieChart = new Chart (ctxcontrol, {
            type : 'pie',
            data : {
                labels :labelsoftypecontrols,
                datasets : [{
                    backgroundColor: ["#2ecc71","#3498db","#95a5a6","#9b59b6","#f1c40f","#e74c3c","#34495e"],
                    label : "percentage",
                    data : counttypecontrol
                }]
            },options : { responsive :true,maintainAspectRatio : false,
                title : {display : true, text : "ratio type control " ,padding : 2},legend :{labels :{ boxWidth: 20}},
                tooltips :{ callbacks: {
                    label: function(tooltipItem, data) {
                        var allData = data.datasets[tooltipItem.datasetIndex].data;
                        var tooltipLabel = data.labels[tooltipItem.index];
                        var tooltipData = allData[tooltipItem.index];

                        return tooltipLabel + ': ' + tooltipData +  '%';
                    }
                }}

            }}) ;

        //code for piechart hits type when first loaded
        var dicttypehits = {
            0 :'ongewerkte hit',1 :'geannuleerde hit', 2: 'gevalideerde hit', 4: 'Duplicate hit'

        };

        var counttypehit =[];
        var labelsoftypehit =[];

        for (i=0;i<hittypes.length;i++) {

            var checkhit = hittypes[i];
            var labelhit = dicttypehits[checkhit];
            var counterhit=0;
            for (j=0;j<hitsvandaag.length;j++){
                if (hitsvandaag[j].typehit==checkhit ) {

                    counterhit= counterhit+1}

            }
            var hittypeperc = ((counterhit/hitsvandaag.length)*100).toFixed(2);
            counttypehit.push(hittypeperc);
            labelsoftypehit.push(labelhit);
            var rowhit = tablehittype.insertRow(i+1);
            var cella = rowhit.insertCell(0);
            var cellb = rowhit.insertCell(1);
            var cellc = rowhit.insertCell(2);
            cella.innerHTML = labelhit;
            cellb.innerHTML = counterhit;
            cellc.innerHTML = hittypeperc;
        };
        var rowtotalhit = tablehittype.insertRow(hittypes.length+1);
        var celltotalhit1 = rowtotalhit.insertCell(0);
        var celltotalhit2= rowtotalhit.insertCell(1);
        var celltotalhit3=rowtotalhit.insertCell(2);

        celltotalhit1.innerHTML="Totaal";
        celltotalhit2.innerHTML= hitsvandaag.length;
        celltotalhit3.innerHTML="100%";

        var canvashit = document.getElementById("piechartcanvashits")
        var ctxhit = canvashit.getContext("2d");
        var hitpieChart = new Chart (ctxhit, {
            type : 'pie',
            data : {
                labels :labelsoftypehit,
                datasets : [{
                    backgroundColor: ["#2ecc71","#3498db","#95a5a6","#9b59b6","#f1c40f","#e74c3c","#34495e"],
                    label : "percentage",
                    data : counttypehit
                }]
            },options : { responsive :true,maintainAspectRatio : false,
                title : {display : true, text : "ratio type hits",padding : 2},legend :{labels :{ boxWidth: 20}},
                tooltips :{ callbacks: {
                    label: function(tooltipItem, data) {
                        var allData = data.datasets[tooltipItem.datasetIndex].data;
                        var tooltipLabel = data.labels[tooltipItem.index];
                        var tooltipData = allData[tooltipItem.index];
                        return tooltipLabel + ': ' + tooltipData +  '%';
                    }
                }}

            }}) ;

        //function for rangeselector
        $('#rangeselect').on('change',function() {

            rangeselect = this.value;
            console.log(rangeselect);
            //remove all rows except th from table with ratio type control
            var rowCount=tablescantype.rows.length;
            for (var x=rowCount-1;x>0;x--) {
                tablescantype.deleteRow(x);
            }
            //remove all rows except th from table with ratio type hits
            var rowCounthits = tablehittype.rows.length;
            for (var x=rowCounthits-1;x>0;x--){

                tablehittype.deleteRow(x);
            }

            var labeldict = {};
            var lengte;
            var lengtehit;
            var checklistcontrol =[];
            var checklisthit=[];

            checklistcontrol.length=0;
            checklisthit.length=0;

            console.log(rangeselect);
            if (rangeselect==0)
            {
                var lengte=controlsvandaag.length;
                var checklistcontrol=controlsvandaag;
                var lengtehit=hitsvandaag.length
                var checklisthit=hitsvandaag;
            }

            else
                if (rangeselect==1)
                {
                    var lengte=controlsgisteren.length;
                    var checklistcontrol=controlsgisteren;
                    var lengtehit=hitsgisteren.length;
                    var checklisthit=hitsgisteren;
                }
                else
                    if (rangeselect==2) {

                        var lengte=controlsdezeweek.length;
                        var checklistcontrol=controlsdezeweek;
                        var lengtehit=hitsdezeweek.length;
                        var checklisthit=hitsdezeweek;
                        console.log("controlsdezeweek"+checklistcontrol.length)
                    }
                    else
                        if (rangeselect==3) {

                            var lengte=controlsvorigeweek.length;
                            var checklistcontrol=controlsvorigeweek;
                            var lengtehit=hitsvorigeweek.length;
                            var checklisthit=hitsvorigeweek;
                        }
                        else
                            if(rangeselect==4){
                                var lengte=controlsdezemaand.length;
                                var checklistcontrol=controlsdezemaand;
                                var lengtehit=hitsdezemaand.length;
                                var checklisthit=hitsdezemaand;
                            }
                            else
                                if(rangeselect==5){
                                    var lengte=controlsvorigemaand.length;
                                    var checklistcontrol=controlsvorigemaand;
                                    var lengtehit=hitsvorigemaand.length;
                                    var checklisthit=hitsvorigemaand;
                                }
                                else
                                    if (rangeselect==6){$("#customrange").show();

                                    }
       
            //code calculate data for piechart typecontrols (e.g. PM, abonnement,...)

            var counttypecontrol =[];
            var labelsoftypecontrols =[];

            for (i=0;i<typecontrols.length;i++) {

                var check = typecontrols[i];
                var label = dicttypecontrol[check];
                var counter=0;
                for (j=0;j<lengte;j++){
                    if ((checklistcontrol[j].typecontrol==check) || (checklistcontrol[j].typecontrol==a))

                        counter= counter+1

                }
                var typeperc = ((counter/lengte)*100).toFixed(2);
                counttypecontrol.push(typeperc);
                labelsoftypecontrols.push(label);
                //code to make table dynamically

                var row = tablescantype.insertRow(i+1);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                cell1.innerHTML = label;
                cell2.innerHTML = counter;
                cell3.innerHTML = typeperc;

            };

            var rowtotal = tablescantype.insertRow(typecontrols.length+1);
            var celltotal1 = rowtotal.insertCell(0);
            var celltotal2= rowtotal.insertCell(1);
            var celltotal3=rowtotal.insertCell(2);

            celltotal1.innerHTML="Totaal";
            celltotal2.innerHTML= lengte;
            celltotal3.innerHTML="100%";


            //code to make piechart control type dynamically

            controlpieChart.data.datasets[0].data = counttypecontrol;
            controlpieChart.data.labels=labelsoftypecontrols;
            controlpieChart.update();

            var dicttypehits = {
                0 :'ongewerkte hit',1 :'geannuleerde hit', 2: 'gevalideerde hit', 4: 'Duplicate hit'

            };

            var counttypehit =[];
            var labelsoftypehit =[];

            for (i=0;i<hittypes.length;i++) {

                var checkhit = hittypes[i];
                var labelhit = dicttypehits[checkhit];
                var counterhit=0;
                for (j=0;j<lengtehit;j++){
                    if (checklisthit[j].typehit==checkhit ) {

                        counterhit= counterhit+1}

                }

                var hittypeperc = ((counterhit/lengtehit)*100).toFixed(2);
                counttypehit.push(hittypeperc);
                labelsoftypehit.push(labelhit);

                var rowhit = tablehittype.insertRow(i+1);
                var cella = rowhit.insertCell(0);
                var cellb = rowhit.insertCell(1);
                var cellc = rowhit.insertCell(2);
                cella.innerHTML = labelhit;
                cellb.innerHTML = counterhit;
                cellc.innerHTML = hittypeperc;

            };

            var rowtotalhit = tablehittype.insertRow(hittypes.length+1);
            var celltotalhit1 = rowtotalhit.insertCell(0);
            var celltotalhit2= rowtotalhit.insertCell(1);
            var celltotalhit3=rowtotalhit.insertCell(2);

            celltotalhit1.innerHTML="Totaal";
            celltotalhit2.innerHTML= lengtehit;
            celltotalhit3.innerHTML="100%";

            hitpieChart.data.datasets[0].data = counttypehit;
            hitpieChart.data.labels=labelsoftypehit;
            hitpieChart.update();

        });

    </script>
</body>
</html>

    
